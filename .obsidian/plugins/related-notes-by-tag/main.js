/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, please visit the github repository of this plugin
*/

var _=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var b=(c,i)=>{for(var t in i)_(c,t,{get:i[t],enumerable:!0})},H=(c,i,t,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let e of k(i))!G.call(c,e)&&e!==t&&_(c,e,{get:()=>i[e],enumerable:!(s=F(i,e))||s.enumerable});return c};var W=c=>H(_({},"__esModule",{value:!0}),c);var V={};b(V,{default:()=>P});module.exports=W(V);var N=require("obsidian");var g=require("obsidian");var w=class{constructor(i){this.app=i}async searchFolders(i){if(!i)return[];let s=this.app.vault.getAllFolders().map(e=>e.path==="/"?"/":e.path.startsWith("/")?e.path:"/"+e.path);return s=s.filter(e=>e.toLowerCase().includes(i.toLowerCase())).sort(),s}displayFolderSuggestions(i){if(document.querySelectorAll(".folder-suggestions-container").forEach(l=>l.remove()),i.length===0)return;let s=document.activeElement;if(!(s instanceof HTMLInputElement))return;let e=s.closest(".setting-item-control");if(!e)return;e.style.position="relative",console.log("Setting up suggestions container with parent:",e);let a=document.createElement("div");a.className="folder-suggestions-container",i.forEach(l=>{let d=document.createElement("div");d.className="folder-suggestion-item",d.textContent=l,d.addEventListener("click",()=>{s.value=l;let u=new Event("input",{bubbles:!0});s.dispatchEvent(u),a.remove()}),a.appendChild(d)});let n=s.getBoundingClientRect();e.appendChild(a),a.style.top=`${n.height+4}px`,a.style.width=`${n.width}px`,a.offsetHeight,console.log("Container styles after positioning:",{position:a.style.position,right:a.style.right,left:a.style.left,top:a.style.top,width:a.style.width});let r=l=>{!a.contains(l.target)&&l.target!==s&&(a.remove(),document.removeEventListener("click",r))};setTimeout(()=>{document.addEventListener("click",r)},0)}};var y={defaultSortMode:"name",defaultFilterMode:1,excludedTags:"",defaultGroupState:"expanded",showMatchedTags:!1,excludedFolders:[]},f=class extends g.PluginSettingTab{constructor(i,t){super(i,t),this.plugin=t,this.folderSuggestions=new w(i)}display(){let{containerEl:i}=this;i.empty(),new g.Setting(i).setName("Default sort mode").setDesc("Default sort method for related notes").addDropdown(e=>e.addOption("name","Name").addOption("date","Date Edited").addOption("created","Date Created").setValue(this.plugin.settings.defaultSortMode).onChange(async a=>{this.plugin.settings.defaultSortMode=a,await this.plugin.saveSettings()})),new g.Setting(i).setName("Excluded tags").setDesc("Comma-separated list of tags to exclude from related notes (# prefix optional)").addText(e=>e.setPlaceholder("e.g., ignore, draft, #private").setValue(this.plugin.settings.excludedTags).onChange(async a=>{this.plugin.settings.excludedTags=a,await this.plugin.saveSettings()})),new g.Setting(i).setName("Default group state").setDesc("Initial expansion state of tag groups").addDropdown(e=>e.addOption("collapsed","Collapsed").addOption("expanded","Expanded").setValue(this.plugin.settings.defaultGroupState).onChange(async a=>{this.plugin.settings.defaultGroupState=a,await this.plugin.saveSettings()})),i.createEl("h3",{text:"Folder Exclusion"}),i.createEl("p",{text:"Exclude files from specific folders when finding related notes. Use absolute paths from vault root (e.g., /Personal/Journal).",cls:"setting-item-description"});let t=i.createDiv("folder-exclusion-container");this.renderFolderExclusions(t),new g.Setting(i).setName("Add another exclusion").setDesc("Add a new folder to exclude from related notes").addButton(e=>e.setIcon("folder-plus").setTooltip("Add another folder exclusion").setCta().onClick(()=>{this.addNewFolderExclusion(t)})),i.createEl("h3",{text:"Activation and usage instructions"});let s=i.createDiv("related-notes-instructions");s.createEl("p",{text:"To activate the Related Notes by Tag sidebar:"}),s.createEl("ul",{},e=>{e.createEl("li",{text:"Click the ribbon icon (tag icon) in the top right if visible"}),e.createEl("li",{text:'Or use the command palette (cmd/ctrl-P on desktop, pull down from top of Obsidian on mobile) and search for: "Related Notes by Tag: Open sidebar"'})}),s.createEl("p",{text:"Usage:"}),s.createEl("ul",{},e=>{e.createEl("li",{text:"Click tag group header to expand/collapse group"}),e.createEl("li",{text:"Click note name to open in current tab"}),e.createEl("li",{text:"Cmd/ctrl-click note name to open note in a new tab"}),e.createEl("li",{text:"Click Name/Date to change sort order"})})}renderFolderExclusions(i){if(i.empty(),this.plugin.settings.excludedFolders.length===0){i.createEl("p",{text:'No folders excluded yet. Click "Add Folder Path" to create one.',cls:"setting-item-description"});return}this.plugin.settings.excludedFolders.forEach((t,s)=>{let e=new g.Setting(i),a=()=>{let n=t.includeChildren?" (selected folder plus subfolders)":" (selected folder only)";e.descEl.empty(),e.descEl.createSpan({text:`${s+1}: ${t.path||"(empty)"}${n}`,cls:"setting-item-description"})};e.addText(n=>(n.setPlaceholder("/path/to/folder").setValue(t.path).onChange(async r=>{this.plugin.settings.excludedFolders[s].path=r,await this.plugin.saveSettings(),a()}),n.inputEl.addEventListener("input",async()=>{let r=await this.folderSuggestions.searchFolders(n.getValue());this.folderSuggestions.displayFolderSuggestions(r)}),n)).addToggle(n=>n.setTooltip("Include subfolders").setValue(t.includeChildren).onChange(async r=>{this.plugin.settings.excludedFolders[s].includeChildren=r,await this.plugin.saveSettings(),a()})).addButton(n=>(n.setIcon("trash-2").setTooltip("Delete folder exclusion").onClick(async()=>{this.plugin.settings.excludedFolders.splice(s,1),await this.plugin.saveSettings(),this.renderFolderExclusions(i)}),n.buttonEl.addClass("folder-exclusion-delete-btn"),n)),a()})}addNewFolderExclusion(i){let t={path:"",includeChildren:!0,id:Date.now().toString()};this.plugin.settings.excludedFolders.push(t),this.plugin.saveSettings(),this.renderFolderExclusions(i)}};var x=require("obsidian");var I=require("obsidian"),S=class{constructor(i){this.app=i}analyzeRelatedNotes(i,t){let s=this.app.metadataCache.getFileCache(i);if(!s)return{relatedNotesMap:new Map,currentNoteTags:[]};let e=(0,I.getAllTags)(s);if(!e||e.length===0)return{relatedNotesMap:new Map,currentNoteTags:[]};let a=this.getFilteredTags(e,t.excludedTags);return{relatedNotesMap:this.findRelatedNotes(i,a,t.defaultFilterMode,t),currentNoteTags:a}}getFilteredTags(i,t){let s=t.split(",").map(e=>{let a=e.trim().toLowerCase();return a.startsWith("#")?a:`#${a}`}).filter(e=>e.length>1);return[...new Set(i)].filter(e=>!s.includes(e.toLowerCase()))}findRelatedNotes(i,t,s,e){let a=new Map,n=this.app.vault.getMarkdownFiles();for(let r of n){if(r.path===i.path||this.isFileInExcludedFolder(r,e))continue;let l=this.getOverlappingTags(r,t);if(l.length>=s){let d={file:r,matchedTags:l};l.forEach(u=>{var v;a.has(u)||a.set(u,[]),(v=a.get(u))==null||v.push(d)})}}return a}getOverlappingTags(i,t){let s=this.app.metadataCache.getFileCache(i);if(!s)return[];let e=(0,I.getAllTags)(s);if(!e)return[];let a=[...new Set(e)];return t.filter(n=>a.includes(n))}sortFiles(i,t){let s=[...i];switch(t){case"date":return s.sort((e,a)=>a.file.stat.mtime-e.file.stat.mtime);case"created":return s.sort((e,a)=>a.file.stat.ctime-e.file.stat.ctime);default:return s.sort((e,a)=>e.file.basename.localeCompare(a.file.basename))}}isFileInExcludedFolder(i,t){let s=i.path;return t.excludedFolders.some(e=>{let a=this.normalizePath(e.path),n=this.normalizePath(s);return e.includeChildren?n.startsWith(a+"/")||n===a:n.substring(0,n.lastIndexOf("/"))===a})}normalizePath(i){return i.replace(/^\/+|\/+$/g,"").replace(/\/+/g,"/")}};var T=require("obsidian");var M={SORT:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/><path d="M11 12h4"/><path d="M11 16h7"/><path d="M11 20h10"/></svg>',FILTER:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/></svg>',TAGS_TOGGLE:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/><path d="M6 9.01V9"/><path d="m15 5 6.3 6.3a2.69 2.69 0 0 1 0 3.79L17.5 19a2.69 2.69 0 0 1-3.79 0L10 15.21"/></svg>',DROPDOWN_CARET:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="m6 9 6 6 6-6"/></svg>',RELATED_NOTES:'<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/><path d="M6 9.01V9"/><path d="m15 5 6.3 6.3a2.69 2.69 0 0 1 0 3.79L17.5 19a2.69 2.69 0 0 1-3.79 0L10 15.21"/></svg>'},o={CONTAINER:"related-notes-container",HEADER:"related-notes-header",ACTION_BUTTONS:"action-buttons",SORT_CONTROLS:"sort-controls",FILTER_CONTROLS:"filter-controls",TAGS_TOGGLE_CONTROLS:"tags-toggle-controls",DROPDOWN_CONTAINER:"dropdown-container",DROPDOWN_TRIGGER:"dropdown-trigger",DROPDOWN_MENU:"dropdown-menu",DROPDOWN_ITEM:"dropdown-item",DROPDOWN_ITEM_ACTIVE:"is-active",DROPDOWN_VISIBLE:"is-visible",TAG_GROUP:"related-notes-tag-group",TAG_GROUP_HEADER:"related-notes-tag-group-header",NOTES_LIST:"related-notes-list",LIST_ITEM:"related-notes-list-item",NOTE_LINK:"related-note-link",MATCHED_TAGS:"matched-tags",MATCHED_TAG:"matched-tag",SEPARATOR:"related-notes-separator",PREVIEW:"related-notes-preview",PREVIEW_LOADED:"is-loaded",INSTRUCTIONS:"related-notes-instructions"},C={VIEW_UPDATE_DELAY:50,PREVIEW_RENDER_DELAY:150},m={PREVIEW_POPUP_WIDTH:400,PREVIEW_POPUP_MARGIN:10,PREVIEW_MAX_HEIGHT:"40vh"},p={NAME:"name",DATE:"date",CREATED:"created"},h={ONE_TAG:1,TWO_TAGS:2,THREE_TAGS:3};var D={[p.NAME]:"Name",[p.DATE]:"Modified Date",[p.CREATED]:"Created Date"},A={[h.ONE_TAG]:"Match at least 1 tag",[h.TWO_TAGS]:"Match at least 2 tags",[h.THREE_TAGS]:"Match at least 3 tags"};var O=class extends T.Component{constructor(t){super();this.app=t;this.previewPopup=null;this.currentPreviewFile=null;this.isModifierHeld=!1;this.lastMousePosition={x:0,y:0};this.trackMousePosition=t=>{this.lastMousePosition={x:t.clientX,y:t.clientY}};this.handleKeyDown=t=>{if(this.isModifierHeld=t.metaKey||t.ctrlKey,this.isModifierHeld){let s=document.elementFromPoint(this.lastMousePosition.x,this.lastMousePosition.y),e=s==null?void 0:s.closest(`.${o.NOTE_LINK}`);if(e instanceof HTMLElement&&e.dataset.filePath){let a=this.app.vault.getAbstractFileByPath(e.dataset.filePath);a instanceof T.TFile&&this.showPreview(a,e)}}};this.handleKeyUp=t=>{(t.key==="Meta"||t.key==="Control")&&(this.isModifierHeld=!1,this.previewPopup&&this.hidePreview())};this.hidePreviewOnClick=()=>{this.hidePreview()};this.setupEventListeners()}setupEventListeners(){document.addEventListener("mousemove",this.trackMousePosition),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}cleanup(){document.removeEventListener("mousemove",this.trackMousePosition),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.hidePreview(),this.unload()}showPreview(t,s){this.hidePreview(),this.previewPopup=document.body.createDiv(o.PREVIEW),this.currentPreviewFile=t;let e=this.calculatePosition(s);this.applyPopupStyles(e),document.addEventListener("click",this.hidePreviewOnClick,{once:!0}),this.renderPreviewContent(t)}calculatePosition(t){let s=t.getBoundingClientRect(),e=window.innerWidth,a=m.PREVIEW_POPUP_WIDTH,n=m.PREVIEW_POPUP_MARGIN,r;return s.right+a+n<=e?r=s.right+n:s.left-a-n>=0?r=s.left-a-n:r=Math.max(n,Math.min((e-a)/2,e-a-n)),{left:r,top:s.top}}applyPopupStyles(t){this.previewPopup&&Object.assign(this.previewPopup.style,{position:"fixed",left:`${t.left}px`,top:`${t.top}px`,zIndex:"9999",width:`${m.PREVIEW_POPUP_WIDTH}px`,maxHeight:m.PREVIEW_MAX_HEIGHT,overflowY:"auto"})}renderPreviewContent(t){setTimeout(async()=>{var s;if(this.previewPopup&&this.currentPreviewFile===t&&this.isModifierHeld)try{let e=await this.app.vault.read(t);await T.MarkdownRenderer.render(this.app,e,this.previewPopup,t.path,this),(s=this.previewPopup)==null||s.addClass(o.PREVIEW_LOADED)}catch(e){console.error("Failed to render preview:",e),this.previewPopup&&this.previewPopup.setText("Failed to load preview")}},C.PREVIEW_RENDER_DELAY)}hidePreview(){this.previewPopup&&(this.previewPopup.remove(),this.previewPopup=null,this.currentPreviewFile=null)}getIsModifierHeld(){return this.isModifierHeld}};var R=class{constructor(){this.openDropdowns=new Set;this.handleGlobalClick=i=>{let t=i.target,s=!1;for(let e of this.openDropdowns)if(e.contains(t)){s=!0;break}s||this.closeAllDropdowns()};document.addEventListener("click",this.handleGlobalClick)}closeAllDropdowns(){this.openDropdowns.forEach(i=>{let t=i.querySelector(`.${o.DROPDOWN_MENU}`);t&&t.classList.remove(o.DROPDOWN_VISIBLE)})}createDropdown(i,t){let s=i.createDiv(o.DROPDOWN_CONTAINER);t.containerClass&&s.addClass(t.containerClass);let e=s.createEl("button",{cls:`${o.DROPDOWN_TRIGGER} clickable-icon`}),r=new DOMParser().parseFromString(t.icon,"image/svg+xml").documentElement;e.appendChild(r);let l=s.createDiv(o.DROPDOWN_MENU);return t.options.forEach(d=>{let u=l.createEl("div",{cls:`${o.DROPDOWN_ITEM} ${d.isActive?o.DROPDOWN_ITEM_ACTIVE:""}`,text:d.label});u.addEventListener("click",()=>{t.onItemClick(d.value),l.classList.remove(o.DROPDOWN_VISIBLE),l.querySelectorAll(`.${o.DROPDOWN_ITEM}`).forEach(v=>v.classList.remove(o.DROPDOWN_ITEM_ACTIVE)),u.classList.add(o.DROPDOWN_ITEM_ACTIVE)})}),e.addEventListener("click",d=>{d.stopPropagation(),this.closeAllDropdowns(),l.classList.toggle(o.DROPDOWN_VISIBLE),l.classList.contains(o.DROPDOWN_VISIBLE)?this.openDropdowns.add(s):this.openDropdowns.delete(s)}),s}createSortDropdown(i,t,s){let e=[{value:p.NAME,label:D[p.NAME],isActive:t===p.NAME},{value:p.DATE,label:D[p.DATE],isActive:t===p.DATE},{value:p.CREATED,label:D[p.CREATED],isActive:t===p.CREATED}];return this.createDropdown(i,{icon:M.SORT,options:e,onItemClick:a=>s(a),containerClass:o.SORT_CONTROLS})}createFilterDropdown(i,t,s){let e=[{value:h.ONE_TAG,label:A[h.ONE_TAG],isActive:t===h.ONE_TAG},{value:h.TWO_TAGS,label:A[h.TWO_TAGS],isActive:t===h.TWO_TAGS},{value:h.THREE_TAGS,label:A[h.THREE_TAGS],isActive:t===h.THREE_TAGS}];return this.createDropdown(i,{icon:M.FILTER,options:e,onItemClick:a=>s(a),containerClass:o.FILTER_CONTROLS})}createHeader(i){return i.createDiv(o.HEADER)}createActionButtonsContainer(i){return i.createDiv(o.ACTION_BUTTONS)}createTagsToggleButton(i,t,s){let e=i.createEl("button",{cls:`${o.DROPDOWN_TRIGGER} ${o.TAGS_TOGGLE_CONTROLS} clickable-icon ${t?o.DROPDOWN_ITEM_ACTIVE:""}`,title:t?"Hide matched tags":"Show matched tags"}),r=new DOMParser().parseFromString(M.TAGS_TOGGLE,"image/svg+xml").documentElement;return e.appendChild(r),e.addEventListener("click",l=>{l.stopPropagation(),this.closeAllDropdowns();let d=!t;s(d),d?(e.addClass(o.DROPDOWN_ITEM_ACTIVE),e.title="Hide matched tags"):(e.removeClass(o.DROPDOWN_ITEM_ACTIVE),e.title="Show matched tags")}),e}createExpandCollapseButton(i,t,s){let e=i.createEl("button",{cls:"related-notes-expand-collapse clickable-icon",title:t?"Expand all groups":"Collapse all groups"});return this.updateExpandCollapseIcon(e,t),e.addEventListener("click",a=>{a.stopPropagation(),this.closeAllDropdowns();let n=e.getAttribute("data-expand-mode")==="true";s(n)}),e}updateExpandCollapseIcon(i,t){i.empty(),i.setAttribute("data-expand-mode",t.toString()),i.setAttribute("title",t?"Expand all groups":"Collapse all groups");let s=i.createSvg("svg",{attr:{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"}});t?(s.createSvg("path",{attr:{d:"m7 15 5 5 5-5"}}),s.createSvg("path",{attr:{d:"m7 9 5-5 5 5"}})):(s.createSvg("path",{attr:{d:"m7 20 5-5 5 5"}}),s.createSvg("path",{attr:{d:"m7 4 5 5 5-5"}}))}cleanup(){document.removeEventListener("click",this.handleGlobalClick),this.openDropdowns.clear()}};var E="related-notes-by-tag-view",L=class extends x.ItemView{constructor(t,s){super(t);this.tagGroupStates=new Map;this.isExpandAllMode=!1;this.expandCollapseButton=null;this.plugin=s,this.tagAnalyzer=new S(this.app),this.previewManager=new O(this.app),this.uiRenderer=new R}async handleSortChange(t){this.plugin.settings.defaultSortMode=t,await this.plugin.saveSettings(),this.updateView()}async handleFilterChange(t){this.plugin.settings.defaultFilterMode=t,await this.plugin.saveSettings(),this.updateView()}async handleTagsToggle(t){this.plugin.settings.showMatchedTags=t,await this.plugin.saveSettings(),this.updateView()}getViewType(){return E}getDisplayText(){return"Related notes by tag"}getIcon(){return"tag"}async onOpen(){this.container=this.contentEl,this.container.empty(),this.container.addClass(o.CONTAINER),this.updateView()}async onClose(){this.previewManager.cleanup(),this.uiRenderer.cleanup(),this.container.empty()}captureCurrentState(){this.container.querySelectorAll(`.${o.TAG_GROUP}`).forEach(s=>{let e=s.querySelector(`.${o.TAG_GROUP_HEADER}`);if(e!=null&&e.textContent){let a=e.textContent.replace("Notes with tag: ",""),n=s.hasClass("collapsed");this.tagGroupStates.set(a,n)}})}restoreState(){this.container.querySelectorAll(`.${o.TAG_GROUP}`).forEach(s=>{let e=s.querySelector(`.${o.TAG_GROUP_HEADER}`);if(e!=null&&e.textContent){let a=e.textContent.replace("Notes with tag: ",""),n=this.tagGroupStates.get(a);n!==void 0&&s.toggleClass("collapsed",n)}})}handleExpandCollapseToggle(t){this.container.querySelectorAll(`.${o.TAG_GROUP}`).forEach(e=>{let a=t;e.toggleClass("collapsed",!a);let n=e.querySelector(`.${o.TAG_GROUP_HEADER}`);if(n!=null&&n.textContent){let r=n.textContent.replace("Notes with tag: ","");this.tagGroupStates.has(r)&&this.tagGroupStates.delete(r)}}),this.isExpandAllMode=!t,this.expandCollapseButton&&this.uiRenderer.updateExpandCollapseIcon(this.expandCollapseButton,this.isExpandAllMode)}async updateView(){if(!this.plugin.app.workspace.layoutReady)return;this.captureCurrentState(),this.container.empty(),this.container.addClass(o.CONTAINER);let t=this.renderHeader();this.renderControls(t);let s=this.getActiveFile();if(!s)return;let e=this.tagAnalyzer.analyzeRelatedNotes(s,this.plugin.settings);if(e.currentNoteTags.length===0){this.container.createEl("p",{text:"Active note has no tags."});return}if(e.relatedNotesMap.size===0){this.container.createEl("p",{text:"No other notes found with matching tags."});return}this.renderTagGroups(e.relatedNotesMap),this.restoreState()}renderHeader(){return this.uiRenderer.createHeader(this.container)}renderControls(t){let s=this.uiRenderer.createActionButtonsContainer(t);this.uiRenderer.createSortDropdown(s,this.plugin.settings.defaultSortMode,e=>this.handleSortChange(e)),this.uiRenderer.createFilterDropdown(s,this.plugin.settings.defaultFilterMode,e=>this.handleFilterChange(e)),this.uiRenderer.createTagsToggleButton(s,this.plugin.settings.showMatchedTags,e=>this.handleTagsToggle(e)),this.isExpandAllMode=this.plugin.settings.defaultGroupState==="collapsed",this.expandCollapseButton=this.uiRenderer.createExpandCollapseButton(s,this.isExpandAllMode,e=>this.handleExpandCollapseToggle(e))}getActiveFile(){let t=this.app.workspace.getActiveFile();return!t||!(t instanceof x.TFile)?(this.container.createEl("p",{text:"No active note or not a markdown file."}),null):t}renderTagGroups(t){Array.from(t.entries()).sort(([,e],[,a])=>a.length-e.length).forEach(([e,a])=>{let n=this.tagGroupStates.get(e),r=n!==void 0?n:this.plugin.settings.defaultGroupState==="collapsed",l=this.container.createDiv({cls:`${o.TAG_GROUP} ${r?"collapsed":"expanded"}`}),d=this.tagAnalyzer.sortFiles(a,this.plugin.settings.defaultSortMode),u=l.createEl("div",{text:`Notes with tag: ${e}  (`+d.length+")",cls:o.TAG_GROUP_HEADER}),v=l.createEl("ul",{cls:o.NOTES_LIST});this.setupTagGroupToggle(l,u,e),this.renderFileList(v,d),l.createEl("hr",{cls:o.SEPARATOR})})}setupTagGroupToggle(t,s,e){s.addEventListener("click",()=>{let a=!t.hasClass("collapsed");t.toggleClass("collapsed",a),this.tagGroupStates.set(e,a)})}renderFileList(t,s){s.forEach(e=>{let a=t.createEl("li",{cls:o.LIST_ITEM}),n=this.createFileLink(a,e.file);this.setupFileLinkEvents(n,e.file),this.plugin.settings.showMatchedTags&&this.renderMatchedTags(a,e.matchedTags)})}createFileLink(t,s){let e=t.createEl("a",{text:s.basename,href:"#",title:`Hold Cmd/Ctrl + hover to preview
Click to open`,cls:o.NOTE_LINK});return e.dataset.filePath=s.path,e}setupFileLinkEvents(t,s){let e;t.addEventListener("mouseenter",a=>{a.metaKey||a.ctrlKey?this.previewManager.showPreview(s,t):e=setTimeout(()=>{t.matches(":hover")&&this.previewManager.getIsModifierHeld()&&this.previewManager.showPreview(s,t)},100)}),t.addEventListener("mouseleave",()=>{e&&clearTimeout(e),this.previewManager.getIsModifierHeld()||this.previewManager.hidePreview()}),t.addEventListener("click",a=>{a.preventDefault(),a.ctrlKey||a.metaKey?this.app.workspace.getLeaf("tab").openFile(s,{active:!0}):this.app.workspace.getLeaf().openFile(s,{active:!0})})}renderMatchedTags(t,s){let e=t.createDiv(o.MATCHED_TAGS);s.forEach(a=>{e.createSpan({text:a,cls:o.MATCHED_TAG})})}};var P=class extends N.Plugin{async onload(){await this.loadSettings(),this.registerView(E,i=>new L(i,this)),this.addCommand({id:"open-related-notes-panel",name:"Open sidebar",callback:()=>{this.activateView()}}),this.addSettingTab(new f(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",i=>{let t=this.getView();t&&i&&t.leaf!==i&&i.view.getViewType()==="markdown"&&setTimeout(async()=>{let s=this.getView();s&&await s.updateView()},C.VIEW_UPDATE_DELAY)})),this.registerEvent(this.app.metadataCache.on("changed",async i=>{var s;let t=this.getView();t&&((s=this.app.workspace.getActiveFile())==null?void 0:s.path)===i.path&&await t.updateView()})),this.app.workspace.onLayoutReady(()=>{this.initializePanelInSidebar()})}onunload(){}getView(){let i=this.app.workspace.getLeavesOfType(E);return i.length>0?i[0].view:null}async loadSettings(){this.settings=Object.assign({},y,await this.loadData())}async saveSettings(){await this.saveData(this.settings);let i=this.getView();i&&await i.updateView()}async initializePanelInSidebar(){if(this.app.workspace.getLeavesOfType(E).length>0)return;let t=this.app.workspace.getRightLeaf(!1);t&&await t.setViewState({type:E,active:!1})}async activateView(){let i=this.app.workspace.getLeavesOfType(E);if(i.length>0){this.app.workspace.revealLeaf(i[0]);return}let t=this.app.workspace.getRightLeaf(!1);t||(t=this.app.workspace.getRightLeaf(!0)),t?(await t.setViewState({type:E,active:!0}),this.app.workspace.revealLeaf(t)):new N.Notice("Could not Open Related Notes by Tag sidebar: No available leaf.")}};

/* nosourcemap */
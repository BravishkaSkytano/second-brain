/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var W=(u,t,s)=>t in u?k(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s;var G=(u,t)=>{for(var s in t)k(u,s,{get:t[s],enumerable:!0})},_=(u,t,s,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of $(t))!Q.call(u,n)&&n!==s&&k(u,n,{get:()=>t[n],enumerable:!(a=R(t,n))||a.enumerable});return u};var B=u=>_(k({},"__esModule",{value:!0}),u);var f=(u,t,s)=>(W(u,typeof t!="symbol"?t+"":t,s),s);var K={};G(K,{default:()=>N});module.exports=B(K);var p=require("obsidian");var P=require("obsidian");var x=class{constructor(){f(this,"menu");f(this,"queuedActions",[]);let t=this;P.Menu.prototype.showAtPosition=new Proxy(P.Menu.prototype.showAtPosition,{apply(s,a,n){return t.menu=a,t.queuedActions.length>0&&t.runQueuedActions.call(t),s.call(a,...n)}})}runQueuedActions(){let t=this.queuedActions;this.queuedActions=[];for(let s of t)s()}addItem(t){return this.menu?this.menu.addItem(t):this.queuedActions.push(()=>this.addItem(t)),this}removeSection(t){return this.menu?(delete this.menu.submenuConfigs[t],this.menu.items=this.menu.items.filter(s=>s.section!=t)):this.queuedActions.push(()=>this.removeSection(t)),this}addItemAfter(t,s,a){if(this.menu){let n=this.menu.items,d=null;if(n&&(d=n.find(m=>{let y=m.titleEl;return y?y.innerText==s:!1})),d)return this;typeof t=="string"&&(t=[t]),this.menu.addItem(m=>{var M,A;a(m);let y=m.section,T=(A=(M=this.menu)==null?void 0:M.sections)!=null?A:[],S=0;for(let v of t)if(T.includes(v)){S=T.lastIndexOf(v)+1;break}T.remove(y),T.splice(S,0,y)})}else this.queuedActions.push(()=>this.addItemAfter(t,s,a));return this}addSeparator(){return this.menu?this.menu.addSeparator():this.queuedActions.push(()=>this.addSeparator()),this}setMenuClassName(t){var s,a;return this.menu?(a=(s=this.menu)==null?void 0:s.dom)==null||a.classList.add(t):this.queuedActions.push(()=>{this.setMenuClassName(t)}),this}forSection(t,s){if(this.menu){let a=this.menu.items.filter(n=>n.section===t);for(let n=0;n<a.length;n++)s(a[n],n)}else this.queuedActions.push(()=>this.forSection(t,s));return this}flush(){this.queuedActions.length=0}closeAndFlush(){var t;(t=this.menu)==null||t.close(),this.menu=null,this.flush()}};var z={collapsed:"Collapsed by default",expanded:"Expanded by default",removeCollapsing:"Remove collapsing",calloutType:"Callout type",calloutTypePlaceholder:"Callout type...",addMetadata:"Add callout metadata",removeMetadata:"Remove callout metadata",clearFormatting:"Clear formatting",calloutTypes:"Callout types",calloutTypesDesc:"Write a list of callout types (separated by commas) that should appear in context menu.",metadataTypes:"Callout metadata types",metadataTypesDesc:"Write a list of callout metadata types (separated by commas) that should appear in context menu.",copyContent:"Copy callout content",copyLinkPath:"Copy link path",other:"Other..."};var H={collapsed:"\u0421\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E",expanded:"\u0420\u0430\u0437\u0432\u0451\u0440\u043D\u0443\u0442\u044B\u0439 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E",removeCollapsing:"\u0423\u0431\u0440\u0430\u0442\u044C \u0441\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u0435",calloutType:"\u0422\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430",calloutTypePlaceholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0438\u043F \u0432\u044B\u043D\u043E\u0441\u043D\u043E\u0433\u043E \u0431\u043B\u043E\u043A\u0430...",addMetadata:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435",removeMetadata:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0435",clearFormatting:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0444\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435",calloutTypes:"\u0422\u0438\u043F\u044B \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432",calloutTypesDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E).",metadataTypes:"\u0422\u0438\u043F\u044B \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432",metadataTypesDesc:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u0438\u043F\u043E\u0432 \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u0432\u044B\u043D\u043E\u0441\u043D\u044B\u0445 \u0431\u043B\u043E\u043A\u043E\u0432, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0442\u044C\u0441\u044F \u0432 \u043A\u043E\u043D\u0442\u0435\u043A\u0441\u0442\u043D\u043E\u043C \u043C\u0435\u043D\u044E (\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043F\u044F\u0442\u0443\u044E).",copyContent:"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0435",copyLinkPath:"\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0430\u0434\u0440\u0435\u0441 \u0441\u0441\u044B\u043B\u043A\u0438",other:"\u0414\u0440\u0443\u0433\u0438\u0435..."};var q={en:z,ru:H},D=class{constructor(){f(this,"currentLocale","en")}setLocale(t){q[t]&&(this.currentLocale=t)}t(t){return q[this.currentLocale][t]||q.en[t]||t}},i=new D;var J={types:"note, info, tip",metaTypes:"no-icon, no-title"},N=class extends p.Plugin{constructor(){super(...arguments);f(this,"settings");f(this,"menuManager")}async onload(){let s="en";p.getLanguage?s=(0,p.getLanguage)():s=window.localStorage.language,i.setLocale(s),await this.loadSettings(),this.menuManager=new x,this.addSettingTab(new U(this.app,this)),p.Platform.isDesktop&&this.registerDomEvent(window,"contextmenu",a=>{a.button==2&&a.target.closest(".cm-callout")&&this.createCalloutMenu(a)}),p.Platform.isMobile&&this.registerDomEvent(window,"touchstart",a=>{a.target.closest(".cm-callout")&&this.createCalloutMenu(a)})}onunload(){}async loadSettings(){this.settings=Object.assign({},J,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getPath(s){let a=d=>{let m=M=>{let A=M.parentElement||M.parentNode,v=-1,c;for(;A&&(c=A.childNodes[++v]);)if(c==M)return v;return-1},y,T=[],S=m(d);return(y=d.parentElement||d.parentNode)&&(T=a(y)),S>-1&&T.push(d),T},n=s.path;return n||(n=s.composedPath()),(!n||n.length==0)&&(n=a(s.target)),n}createCalloutMenu(s){let a=s.target,n=a.closest(".cm-callout"),d=n.querySelector(".callout"),m=a.closest("a"),y=this.settings.types.split(",").map(e=>e.trim()),T=this.settings.metaTypes.split(",").map(e=>e.trim()),S=["note","info","important","tip","success","question","warning","example","quote","abstract","summary","tldr","todo","hint","check","done","question","faq","help","caution","attention","failure","fail","missing","danger","error","bug","example","cite"],M=d.classList,A=d.getAttribute("data-callout-fold"),v=n.cmView.widget,c=v.editor.editor,g=c.offsetToPos(v.start).line,j=c.offsetToPos(v.end).line,C=c.getLine(g),w=[];for(let e=g;e<=j;e++)w.push(e);let L=C.replace(/(.*?])(.*)/,"$1"),V=n.cmView.widget.getType().replace(/([^|]+)(.*)/,"$1"),O=[...T],E=T.filter(e=>L.includes("|"+e+"|")||L.includes("|"+e+"]")),b=O.filter(e=>!L.includes("|"+e+"|")&&!L.includes("|"+e+"]")),r=this.menuManager;if(r.closeAndFlush(),r.setMenuClassName("callout-menu"),r.removeSection(i.t("type")),r.addItemAfter(["edit"],i.t("copyContent"),e=>e.setTitle(i.t("copyContent")).setSection("edit").onClick(()=>{w.shift();let l="";for(let o of w){let I=c.getLine(o).replace(">","");I=I.replace(/^ /,""),l+=I+`
`}l=l.trim(),navigator.clipboard.writeText(l)})),m&&m.className&&m.className.includes("internal-link")&&r.addItemAfter(["edit"],i.t("copyLinkPath"),e=>e.setTitle(i.t("copyLinkPath")).setSection("clipboard").onClick(()=>{let l=m.getAttribute("data-href")||"";navigator.clipboard.writeText(l)})),M.contains("is-collapsible")&&A=="-"?(r.addItemAfter(["edit"],i.t("expanded"),e=>{e.setTitle(i.t("expanded")).setIcon("plus").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]-","]+"))})}),r.addItemAfter(["edit"],i.t("removeCollapsing"),e=>{e.setTitle(i.t("removeCollapsing")).setIcon("x").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]-","]"))})})):M.contains("is-collapsible")&&A=="+"?(r.addItemAfter(["edit"],i.t("collapsed"),e=>{e.setTitle(i.t("collapsed")).setIcon("minus").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]+","]-"))})}),r.addItemAfter(["edit"],i.t("removeCollapsing"),e=>{e.setTitle(i.t("removeCollapsing")).setIcon("x").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]+","]"))})})):(r.addItemAfter(["edit"],i.t("collapsed"),e=>{e.setTitle(i.t("collapsed")).setIcon("minus").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]","]-"))})}),r.addItemAfter(["edit"],i.t("expanded"),e=>{e.setTitle(i.t("expanded")).setIcon("plus").setSection("collapse").onClick(()=>{c.setLine(g,C.replace("]","]+"))})})),p.Platform.isMobile){for(let e of y){let l=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");r.addItemAfter("type",l,o=>{o.setTitle(l).setSection("custom-type").onClick(()=>{n.cmView.widget.updateType(e)}).setChecked(V==e)})}if(r.addSeparator(),b.length>0)for(let e of b){let l=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");r.addItemAfter("custom-type",l,o=>{o.setTitle(l).setSection("custom-type-metadata").setIcon("plus").onClick(()=>{c.setLine(g,C.replace("]","|"+e+"]"))})})}if(E.length>0)for(let e of E){let l=e[0].toUpperCase()+e.slice(1,e.length).replace("|"," | ");r.addItemAfter("custom-type",l,o=>{o.setTitle(l).setSection("custom-type-metadata").setIcon("minus").onClick(()=>{c.setLine(g,C.replace("|"+e,""))})})}}else r.addItemAfter("type",i.t("calloutType"),e=>{e.setTitle(i.t("calloutType")).setSection("custom-type");let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let o of y)l.addItem(h=>{let I=o[0].toUpperCase()+o.slice(1,o.length).replace("|"," | ");h.setTitle(I).onClick(()=>{n.cmView.widget.updateType(o)}).setChecked(V==o)});l.addItem(o=>{let h=i.t("other");o.setTitle(h).onClick(async()=>{let I=await this.calloutSuggester(S);n.cmView.widget.updateType(I)})})}),b.length>0&&r.addItemAfter("type",i.t("addMetadata"),e=>{e.setTitle(i.t("addMetadata")).setSection("custom-type");let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let o of b)l.addItem(h=>{let I=o[0].toUpperCase()+o.slice(1,o.length).replace("|"," | ");h.setTitle(I).onClick(()=>{c.setLine(g,C.replace("]","|"+o+"]"))})})}),E.length>0&&r.addItem(e=>{e.setTitle(i.t("removeMetadata")).setSection("custom-type");let l=e.setSubmenu();l.dom.classList.add("callout-menu");for(let o of E)l.addItem(h=>{let I=o[0].toUpperCase()+o.slice(1,o.length).replace("|"," | ");h.setTitle(I).onClick(()=>{c.setLine(g,C.replace("|"+o,""))})})});r.addItem(e=>e.setTitle(i.t("clearFormatting")).setIcon("eraser").setSection("clear").onClick(()=>{for(let l of w){let h=c.getLine(l).replace(">","");l==g&&(h=h.replace("]+","]").replace("]-","]").replace(/(\[.*?\])(.*)/,"$2").replace(/^ /,"")),h=h.replace(/^ /,""),c.setLine(l,h)}}))}async calloutSuggester(s){let a=i.t("calloutTypePlaceholder");return new Promise((d,m)=>{new F(this.app,d,m,s,a).open()})}},F=class extends p.FuzzySuggestModal{constructor(s,a,n,d,m){super(s);f(this,"resolve");f(this,"reject");f(this,"values");f(this,"placeholder");this.resolve=a,this.reject=n,this.values=d,this.placeholder=m}getItems(){return this.values}getItemText(s){return this.setPlaceholder(this.placeholder),s}renderSuggestion(s,a){let n=s.item;a.createEl("div",{text:n})}onChooseItem(s){this.resolve(s)}},U=class extends p.PluginSettingTab{constructor(s,a){super(s,a);f(this,"plugin");this.plugin=a}display(){let{containerEl:s}=this;s.empty(),new p.Setting(s).setName(i.t("calloutTypes")).setDesc(i.t("calloutTypesDesc")).addTextArea(a=>a.setValue(this.plugin.settings.types).onChange(async n=>{this.plugin.settings.types=n,await this.plugin.saveSettings()})),new p.Setting(s).setName(i.t("metadataTypes")).setDesc(i.t("metadataTypesDesc")).addTextArea(a=>a.setValue(this.plugin.settings.metaTypes).onChange(async n=>{this.plugin.settings.metaTypes=n,await this.plugin.saveSettings()}))}};

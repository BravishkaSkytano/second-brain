/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Q=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var xe=Object.prototype.hasOwnProperty;var Ne=(i,e,t)=>e in i?Q(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var qe=(i,e)=>{for(var t in e)Q(i,t,{get:e[t],enumerable:!0})},Se=(i,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ve(e))!xe.call(i,s)&&s!==t&&Q(i,s,{get:()=>e[s],enumerable:!(a=_e(e,s))||a.enumerable});return i};var ke=i=>Se(Q({},"__esModule",{value:!0}),i);var y=(i,e,t)=>(Ne(i,typeof e!="symbol"?e+"":e,t),t);var Ge={};qe(Ge,{default:()=>J});module.exports=ke(Ge);var we=require("obsidian");var T=class{constructor(e,t){this.isOpen=!1;this.mediator=t,t.queueBar=this,this.containerEl=e}toggle(){this.isOpen?(this.close(),this.isOpen=!1):(this.open(),this.isOpen=!0)}open(){this.el=this.containerEl.createEl("div",{cls:"q-floating-bar"}),this.buttonHolderEl=this.el.createEl("div",{cls:"q-floating-bar-btn-holder"}),this.el.createEl("button",{text:"X"}).addEventListener("click",()=>{this.toggle()}),this.mediator.onQueueBarOpened()}close(){this.mediator.onQueueBarClosed(),this.el.remove()}renderButtonsForEmpty(){this.buttonHolderEl&&(this.buttonHolderEl.innerHTML="",this.buttonHolderEl.createEl("button",{text:"Show random due note"}).addEventListener("click",()=>{this.mediator.requestNewNote()}))}renderButtonsForNote(e){this.buttonHolderEl&&(this.buttonHolderEl.innerHTML="",e.forEach(t=>{this.buttonHolderEl.createEl("button",{text:t}).addEventListener("click",()=>{this.mediator.onBarButtonClicked(t)})}))}};var _=(l=>(l[l.Learn=0]="Learn",l[l.Todo=1]="Todo",l[l.Habit=2]="Habit",l[l.Check=3]="Check",l[l.ShortMedia=4]="ShortMedia",l[l.LongMedia=5]="LongMedia",l[l.Misc=6]="Misc",l[l.Exclude=7]="Exclude",l))(_||{}),b=(a=>(a[a.Unstarted=0]="Unstarted",a[a.Ongoing=1]="Ongoing",a[a.Finished=2]="Finished",a))(b||{});var Z;function ue(i){Z={app:i.app,plugin:i}}function v(){if(!Z)throw new Error("Plugin context not set");return Z}function le(i){return new Promise((e,t)=>{try{v().app.fileManager.processFrontMatter(i,s=>{e(s)})}catch(a){return console.error(a),null}})}function ee(){return v().app.vault.getMarkdownFiles()}function de(i){v().app.workspace.getLeaf(!1).openFile(i)}function ce(i){i&&v().app.fileManager.processFrontMatter(i.file,e=>{if(e.q=e.q||{},i.qData.template!==6){let t=Object.keys(_).find(a=>_[a]===i.qData.template);e.q.template=t==null?void 0:t.toLowerCase()}if(i.qData.stage!==void 0&&i.qData.stage!==0){let t=Object.keys(b).find(a=>b[a]===i.qData.stage);e.q.stage=t==null?void 0:t.toLowerCase()}i.qData.due!==void 0&&(e.q.due=i.qData.due),i.qData.seen!==void 0&&(e.q.seen=i.qData.seen),i.qData.interval!==void 0&&i.qData.interval!==1&&i.qData.interval!==0&&(e.q.interval=i.qData.interval),i.qData.stability!==void 0&&(e.q.stability=i.qData.stability),i.qData.difficulty!==void 0&&(e.q.difficulty=i.qData.difficulty),i.qData.elapsed!==void 0&&(e.q.elapsed=i.qData.elapsed),i.qData.scheduled!==void 0&&(e.q.scheduled=i.qData.scheduled),i.qData.reps!==void 0&&(e.q.reps=i.qData.reps),i.qData.lapses!==void 0&&(e.q.lapses=i.qData.lapses),i.qData.state!==void 0&&(e.q.state=i.qData.state),i.qData.history!==void 0&&(e.q.history=i.qData.history),Me(e)})}function Me(i){for(let e of Object.keys(i))e.startsWith("q-")&&delete i[e]}function E(i){if(!i.length)return null;let e=Math.floor(Math.random()*i.length);return i[e]}function he(i,e){return i=Math.ceil(i),e=Math.floor(e),Math.floor(Math.random()*(e-i+1))+i}var Fe=.4,L=class{constructor(){this.streakOngoing=!1;this.streakCounter=0}onNoteWasPicked(e){this.incomingNoteDataIsValidForStreak(e)?this.streakOngoing?this.iterateStreak():this.streakShouldBeStarted()&&this.startStreak(e.template):this.streakOngoing&&this.resetStreak()}getCurrentStreakTemplate(){return this.currentStreakTemplate}streakShouldBeStarted(){return Math.random()<Fe}startStreak(e){this.streakCounter=0,this.streakOngoing=!0,this.currentStreakTemplate=e}resetStreak(){this.streakOngoing=!1,this.currentStreakTemplate=null}incomingNoteDataIsValidForStreak(e){return e.template==0&&e.stage===1||e.template==3}iterateStreak(){this.streakCounter+=1,this.streakCounter>20&&this.resetStreak()}};function fe(i){let e={template:6},t=i.q;switch(t.template||""){case"learn":e.template=0;break;case"todo":e.template=1;break;case"habit":e.template=2;break;case"check":e.template=3;break;case"shortmedia":e.template=4;break;case"longmedia":e.template=5;break;case"exclude":e.template=7;break}switch(t.stage||""){case"unstarted":e.stage=0;break;case"ongoing":e.stage=1;break;case"finished":e.stage=2;break;default:e.stage=0}return t.due!==void 0&&(e.due=new Date(t.due)),t.seen!==void 0&&(e.seen=new Date(t.seen)),t.interval!==void 0&&(e.interval=t.interval),t.stability!==void 0&&(e.stability=t.stability),t.difficulty!==void 0&&(e.difficulty=t.difficulty),t.elapsed!==void 0&&(e.elapsed=t.elapsed),t.scheduled!==void 0&&(e.scheduled=t.scheduled),t.reps!==void 0&&(e.reps=t.reps),t.lapses!==void 0&&(e.lapses=t.lapses),t.state!==void 0&&(e.state=t.state),e}function me(i){let e={template:6},t=i["q-type"]||"";switch(t){case"learn-started":case"learn":e.template=0;break;case"todo":e.template=1;break;case"habit":e.template=2;break;case"check":e.template=3;break;case"article":e.template=4;break;case"book-started":case"book":e.template=5;break;case"exclude":case"todo-finished":e.template=7;break}switch(t){case"learn-started":case"book-started":e.stage=1;break;case"book-finished":e.stage=2;break;default:e.stage=0}let a=i["q-data"];if(a)if(e.template==0){let r=a["fsrs-data"];if(r){let n=r.due;n!==void 0&&(e.due=new Date(n)),r.stability!==void 0&&(e.stability=r.stability),r.difficulty!==void 0&&(e.difficulty=r.difficulty),r.elapsed_days!==void 0&&(e.elapsed=r.elapsed_days),r.scheduled_days!==void 0&&(e.scheduled=r.scheduled_days),r.reps!==void 0&&(e.reps=r.reps),r.lapses!==void 0&&(e.lapses=r.lapses),r.state!==void 0&&(e.state=r.state),r.last_review!==void 0&&(e.seen=new Date(r.last_review))}}else{let r=a["due-at"];r&&(e.due=new Date(r))}let s=i["q-interval"];return e.interval=s,e}var p=class{constructor(e,t){this.file=e,this.qData=t}getButtons(){return this.isDue()?this.buttonsWhenDue:this.buttonsWhenNotDue}addScoreToHistory(e){this.qData.seen=new Date}isDue(){return this.qData.due!==void 0&&this.qData.due!==null?this.qData.due<new Date:!0}score(e){throw"scoring should be handled by derived class"}};function m(){return k(1)}function k(i){let e=new Date,t=new Date(e);return t.setDate(e.getDate()+i),t.setHours(3,0,0,0),t}function D(){let i=new Date;return i.setMinutes(i.getMinutes()+10),i}var R=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["Show next"];this.buttonsWhenNotDue=["Show next"]}score(t){this.qData.due=m()}};var B=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["Not today","Later","Done"];this.buttonsWhenNotDue=["Done","Show next"]}score(t){switch(t){case"Not today":this.qData.due=m();break;case"Done":case"Done":this.qData.due=k(this.qData.interval||1);break;case"Later":this.qData.due=D();break;default:console.error("Note type doesn't know this button",t)}}};var c=(i=>(i[i.New=0]="New",i[i.Learning=1]="Learning",i[i.Review=2]="Review",i[i.Relearning=3]="Relearning",i))(c||{}),u=(i=>(i[i.Manual=0]="Manual",i[i.Again=1]="Again",i[i.Hard=2]="Hard",i[i.Good=3]="Good",i[i.Easy=4]="Easy",i))(u||{}),d=class{static card(e){return{...e,state:d.state(e.state),due:d.time(e.due),last_review:e.last_review?d.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),a=e.slice(1).toLowerCase(),s=u[`${t}${a}`];if(s===void 0)throw new Error(`Invalid rating:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),a=e.slice(1).toLowerCase(),s=c[`${t}${a}`];if(s===void 0)throw new Error(`Invalid state:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){let t=Date.parse(e);if(isNaN(t))throw new Error(`Invalid date:[${e}]`);return new Date(t)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:d.time(e.due),rating:d.rating(e.rating),state:d.state(e.state),review:d.time(e.review)}}},Qe=.9,Te=36500,Ee=[.40255,1.18385,3.173,15.69105,7.1949,.5345,1.4604,.0046,1.54575,.1192,1.01925,1.9395,.11,.29605,2.2698,.2315,2.9898,.51655,.6621],Le=!1,Re=!0;var A=i=>{var t,a;let e=Ee;return i!=null&&i.w&&(i.w.length===19?e=i==null?void 0:i.w:i.w.length===17&&(e=i==null?void 0:i.w.concat([0,0]),e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS V5]auto fill w to 19 length"))),{request_retention:(i==null?void 0:i.request_retention)||Qe,maximum_interval:(i==null?void 0:i.maximum_interval)||Te,w:e,enable_fuzz:(t=i==null?void 0:i.enable_fuzz)!=null?t:Le,enable_short_term:(a=i==null?void 0:i.enable_short_term)!=null?a:Re}};function F(i,e){let t={due:i?d.time(i):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:c.New,last_review:void 0};return e&&typeof e=="function"?e(t):t}Date.prototype.scheduler=function(i,e){return Be(this,i,e)},Date.prototype.diff=function(i,e){return Ae(this,i,e)},Date.prototype.format=function(){return Ce(this)},Date.prototype.dueFormat=function(i,e,t){return He(this,i,e,t)};function Be(i,e,t){return new Date(t?q(i).getTime()+e*24*60*60*1e3:q(i).getTime()+e*60*1e3)}function Ae(i,e,t){if(!i||!e)throw new Error("Invalid date");let a=q(i).getTime()-q(e).getTime(),s=0;switch(t){case"days":s=Math.floor(a/(24*60*60*1e3));break;case"minutes":s=Math.floor(a/(60*1e3));break}return s}function Ce(i){let e=q(i),t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),r=e.getHours(),n=e.getMinutes(),o=e.getSeconds();return`${t}-${M(a)}-${M(s)} ${M(r)}:${M(n)}:${M(o)}`}function M(i){return i<10?`0${i}`:`${i}`}var te=[60,60,24,31,12],ae=["second","min","hour","day","month","year"];function He(i,e,t,a=ae){i=q(i),e=q(e),a.length!==ae.length&&(a=ae);let s=i.getTime()-e.getTime(),r;for(s/=1e3,r=0;r<te.length&&!(s<te[r]);r++)s/=te[r];return`${Math.floor(s)}${t?a[r]:""}`}function q(i){return d.time(i)}var We=[u.Again,u.Hard,u.Good,u.Easy],Pe=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function Oe(i,e,t){let a=1;for(let n of Pe)a+=n.factor*Math.max(Math.min(i,n.end)-n.start,0);i=Math.min(i,t);let s=Math.max(2,Math.round(i-a)),r=Math.min(Math.round(i+a),t);return i>e&&(s=Math.max(s,e+1)),s=Math.min(s,r),{min_ivl:s,max_ivl:r}}function ie(i,e,t){return Math.min(Math.max(i,e),t)}var se=class{constructor(e){y(this,"c");y(this,"s0");y(this,"s1");y(this,"s2");let t=Ie();this.c=1,this.s0=t(" "),this.s1=t(" "),this.s2=t(" "),e==null&&(e=+new Date),this.s0-=t(e),this.s0<0&&(this.s0+=1),this.s1-=t(e),this.s1<0&&(this.s1+=1),this.s2-=t(e),this.s2<0&&(this.s2+=1)}next(){let e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function Ie(){let i=4022871197;return function(e){e=String(e);for(let t=0;t<e.length;t++){i+=e.charCodeAt(t);let a=.02519603282416938*i;i=a>>>0,a-=i,a*=i,i=a>>>0,a-=i,i+=a*4294967296}return(i>>>0)*23283064365386963e-26}}function $e(i){let e=new se(i),t=()=>e.next();return t.int32=()=>e.next()*4294967296|0,t.double=()=>t()+(t()*2097152|0)*11102230246251565e-32,t.state=()=>e.state,t.importState=a=>(e.state=a,t),t}var ge=-.5,pe=19/81,re=class{constructor(e){y(this,"param");y(this,"intervalModifier");y(this,"_seed");this.param=new Proxy(A(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(e,1/ge)-1)/pe).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){let e=this;return{set:function(t,a,s){return a==="request_retention"&&Number.isFinite(s)&&(e.intervalModifier=e.calculate_interval_modifier(Number(s))),Reflect.set(t,a,s),!0}}}update_parameters(e){let t=A(e);for(let a in t)if(a in this.param){let s=a;this.param[s]=t[s]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return this.constrain_difficulty(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1)}apply_fuzz(e,t){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);let a=$e(this._seed)(),{min_ivl:s,max_ivl:r}=Oe(e,t,this.param.maximum_interval);return Math.floor(a*(r-s+1)+s)}next_interval(e,t){let a=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(a,t)}linear_damping(e,t){return+(e*(10-t)/9).toFixed(8)}next_difficulty(e,t){let a=-this.param.w[6]*(t-3),s=e+this.linear_damping(a,e);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(u.Easy),s))}constrain_difficulty(e){return Math.min(Math.max(+e.toFixed(8),1),10)}mean_reversion(e,t){return+(this.param.w[7]*e+(1-this.param.w[7])*t).toFixed(8)}next_recall_stability(e,t,a,s){let r=u.Hard===s?this.param.w[15]:1,n=u.Easy===s?this.param.w[16]:1;return+ie(t*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(t,-this.param.w[9])*(Math.exp((1-a)*this.param.w[10])-1)*r*n),.01,36500).toFixed(8)}next_forget_stability(e,t,a){return+ie(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(t+1,this.param.w[13])-1)*Math.exp((1-a)*this.param.w[14]),.01,36500).toFixed(8)}next_short_term_stability(e,t){return+ie(e*Math.exp(this.param.w[17]*(t-3+this.param.w[18])),.01,36500).toFixed(8)}forgetting_curve(e,t){return+Math.pow(1+pe*e/t,ge).toFixed(8)}};function ye(){let i=this.review_time.getTime(),e=this.current.reps,t=this.current.difficulty*this.current.stability;return`${i}_${e}_${t}`}var ne=(i=>(i.SCHEDULER="Scheduler",i.SEED="Seed",i))(ne||{}),C=class{constructor(e,t,a,s={seed:ye}){y(this,"last");y(this,"current");y(this,"review_time");y(this,"next",new Map);y(this,"algorithm");y(this,"initSeedStrategy");this.algorithm=a,this.initSeedStrategy=s.seed.bind(this),this.last=d.card(e),this.current=d.card(e),this.review_time=d.time(t),this.init()}init(){let{state:e,last_review:t}=this.current,a=0;e!==c.New&&t&&(a=this.review_time.diff(t,"days")),this.current.last_review=this.review_time,this.current.elapsed_days=a,this.current.reps+=1,this.algorithm.seed=this.initSeedStrategy()}preview(){return{[u.Again]:this.review(u.Again),[u.Hard]:this.review(u.Hard),[u.Good]:this.review(u.Good),[u.Easy]:this.review(u.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let e of We)yield this.review(e)}review(e){let{state:t}=this.last,a;switch(t){case c.New:a=this.newState(e);break;case c.Learning:case c.Relearning:a=this.learningState(e);break;case c.Review:a=this.reviewState(e);break}if(a)return a;throw new Error("Invalid grade")}buildLog(e){let{last_review:t,due:a,elapsed_days:s}=this.last;return{rating:e,state:this.current.state,due:t||a,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:s,scheduled_days:this.current.scheduled_days,review:this.review_time}}},H=class extends C{newState(e){let t=this.next.get(e);if(t)return t;let a=d.card(this.current);switch(a.difficulty=this.algorithm.init_difficulty(e),a.stability=this.algorithm.init_stability(e),e){case u.Again:a.scheduled_days=0,a.due=this.review_time.scheduler(1),a.state=c.Learning;break;case u.Hard:a.scheduled_days=0,a.due=this.review_time.scheduler(5),a.state=c.Learning;break;case u.Good:a.scheduled_days=0,a.due=this.review_time.scheduler(10),a.state=c.Learning;break;case u.Easy:{let r=this.algorithm.next_interval(a.stability,this.current.elapsed_days);a.scheduled_days=r,a.due=this.review_time.scheduler(r,!0),a.state=c.Review;break}default:throw new Error("Invalid grade")}let s={card:a,log:this.buildLog(e)};return this.next.set(e,s),s}learningState(e){let t=this.next.get(e);if(t)return t;let{state:a,difficulty:s,stability:r}=this.last,n=d.card(this.current),o=this.current.elapsed_days;switch(n.difficulty=this.algorithm.next_difficulty(s,e),n.stability=this.algorithm.next_short_term_stability(r,e),e){case u.Again:{n.scheduled_days=0,n.due=this.review_time.scheduler(5,!1),n.state=a;break}case u.Hard:{n.scheduled_days=0,n.due=this.review_time.scheduler(10),n.state=a;break}case u.Good:{let h=this.algorithm.next_interval(n.stability,o);n.scheduled_days=h,n.due=this.review_time.scheduler(h,!0),n.state=c.Review;break}case u.Easy:{let h=this.algorithm.next_short_term_stability(r,u.Good),g=this.algorithm.next_interval(h,o),w=Math.max(this.algorithm.next_interval(n.stability,o),g+1);n.scheduled_days=w,n.due=this.review_time.scheduler(w,!0),n.state=c.Review;break}default:throw new Error("Invalid grade")}let l={card:n,log:this.buildLog(e)};return this.next.set(e,l),l}reviewState(e){let t=this.next.get(e);if(t)return t;let a=this.current.elapsed_days,{difficulty:s,stability:r}=this.last,n=this.algorithm.forgetting_curve(a,r),o=d.card(this.current),l=d.card(this.current),h=d.card(this.current),g=d.card(this.current);this.next_ds(o,l,h,g,s,r,n),this.next_interval(o,l,h,g,a),this.next_state(o,l,h,g),o.lapses+=1;let w={card:o,log:this.buildLog(u.Again)},f={card:l,log:super.buildLog(u.Hard)},X={card:h,log:super.buildLog(u.Good)},S={card:g,log:super.buildLog(u.Easy)};return this.next.set(u.Again,w),this.next.set(u.Hard,f),this.next.set(u.Good,X),this.next.set(u.Easy,S),this.next.get(e)}next_ds(e,t,a,s,r,n,o){e.difficulty=this.algorithm.next_difficulty(r,u.Again),e.stability=this.algorithm.next_forget_stability(r,n,o),t.difficulty=this.algorithm.next_difficulty(r,u.Hard),t.stability=this.algorithm.next_recall_stability(r,n,o,u.Hard),a.difficulty=this.algorithm.next_difficulty(r,u.Good),a.stability=this.algorithm.next_recall_stability(r,n,o,u.Good),s.difficulty=this.algorithm.next_difficulty(r,u.Easy),s.stability=this.algorithm.next_recall_stability(r,n,o,u.Easy)}next_interval(e,t,a,s,r){let n,o;n=this.algorithm.next_interval(t.stability,r),o=this.algorithm.next_interval(a.stability,r),n=Math.min(n,o),o=Math.max(o,n+1);let l=Math.max(this.algorithm.next_interval(s.stability,r),o+1);e.scheduled_days=0,e.due=this.review_time.scheduler(5),t.scheduled_days=n,t.due=this.review_time.scheduler(n,!0),a.scheduled_days=o,a.due=this.review_time.scheduler(o,!0),s.scheduled_days=l,s.due=this.review_time.scheduler(l,!0)}next_state(e,t,a,s){e.state=c.Relearning,t.state=c.Review,a.state=c.Review,s.state=c.Review}},W=class extends C{newState(e){let t=this.next.get(e);if(t)return t;this.current.scheduled_days=0,this.current.elapsed_days=0;let a=d.card(this.current),s=d.card(this.current),r=d.card(this.current),n=d.card(this.current);this.init_ds(a,s,r,n);let o=0;return this.next_interval(a,s,r,n,o),this.next_state(a,s,r,n),this.update_next(a,s,r,n),this.next.get(e)}init_ds(e,t,a,s){e.difficulty=this.algorithm.init_difficulty(u.Again),e.stability=this.algorithm.init_stability(u.Again),t.difficulty=this.algorithm.init_difficulty(u.Hard),t.stability=this.algorithm.init_stability(u.Hard),a.difficulty=this.algorithm.init_difficulty(u.Good),a.stability=this.algorithm.init_stability(u.Good),s.difficulty=this.algorithm.init_difficulty(u.Easy),s.stability=this.algorithm.init_stability(u.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){let t=this.next.get(e);if(t)return t;let a=this.current.elapsed_days,{difficulty:s,stability:r}=this.last,n=this.algorithm.forgetting_curve(a,r),o=d.card(this.current),l=d.card(this.current),h=d.card(this.current),g=d.card(this.current);return this.next_ds(o,l,h,g,s,r,n),this.next_interval(o,l,h,g,a),this.next_state(o,l,h,g),o.lapses+=1,this.update_next(o,l,h,g),this.next.get(e)}next_ds(e,t,a,s,r,n,o){e.difficulty=this.algorithm.next_difficulty(r,u.Again),e.stability=this.algorithm.next_forget_stability(r,n,o),t.difficulty=this.algorithm.next_difficulty(r,u.Hard),t.stability=this.algorithm.next_recall_stability(r,n,o,u.Hard),a.difficulty=this.algorithm.next_difficulty(r,u.Good),a.stability=this.algorithm.next_recall_stability(r,n,o,u.Good),s.difficulty=this.algorithm.next_difficulty(r,u.Easy),s.stability=this.algorithm.next_recall_stability(r,n,o,u.Easy)}next_interval(e,t,a,s,r){let n,o,l,h;n=this.algorithm.next_interval(e.stability,r),o=this.algorithm.next_interval(t.stability,r),l=this.algorithm.next_interval(a.stability,r),h=this.algorithm.next_interval(s.stability,r),n=Math.min(n,o),o=Math.max(o,n+1),l=Math.max(l,o+1),h=Math.max(h,l+1),e.scheduled_days=n,e.due=this.review_time.scheduler(n,!0),t.scheduled_days=o,t.due=this.review_time.scheduler(o,!0),a.scheduled_days=l,a.due=this.review_time.scheduler(l,!0),s.scheduled_days=h,s.due=this.review_time.scheduler(h,!0)}next_state(e,t,a,s){e.state=c.Review,t.state=c.Review,a.state=c.Review,s.state=c.Review}update_next(e,t,a,s){let r={card:e,log:this.buildLog(u.Again)},n={card:t,log:super.buildLog(u.Hard)},o={card:a,log:super.buildLog(u.Good)},l={card:s,log:super.buildLog(u.Easy)};this.next.set(u.Again,r),this.next.set(u.Hard,n),this.next.set(u.Good,o),this.next.set(u.Easy,l)}},oe=class{constructor(e){y(this,"fsrs");this.fsrs=e}replay(e,t,a){return this.fsrs.next(e,t,a)}handleManualRating(e,t,a,s,r,n,o){if(typeof t>"u")throw new Error("reschedule: state is required for manual rating");let l,h;if(t===c.New)l={rating:u.Manual,state:t,due:o!=null?o:a,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:a},h=F(a),h.last_review=a;else{if(typeof o>"u")throw new Error("reschedule: due is required for manual rating");let g=o.diff(a,"days");l={rating:u.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,review:a},h={...e,state:t,due:o,last_review:a,stability:r||e.stability,difficulty:n||e.difficulty,elapsed_days:s,scheduled_days:g,reps:e.reps+1}}return{card:h,log:l}}reschedule(e,t){let a=[],s=F(e.due);for(let r of t){let n;if(r.review=d.time(r.review),r.rating===u.Manual){let o=0;s.state!==c.New&&s.last_review&&(o=r.review.diff(s.last_review,"days")),n=this.handleManualRating(s,r.state,r.review,o,r.stability,r.difficulty,r.due?d.time(r.due):void 0)}else n=this.replay(s,r.review,r.rating);a.push(n),s=n.card}return a}calculateManualRecord(e,t,a,s){if(!a)return null;let{card:r,log:n}=a,o=d.card(e);return o.due.getTime()===r.due.getTime()?null:(o.scheduled_days=r.due.diff(o.due,"days"),this.handleManualRating(o,r.state,d.time(t),n.elapsed_days,s?r.stability:void 0,s?r.difficulty:void 0,r.due))}},P=class extends re{constructor(t){super(t);y(this,"strategyHandler",new Map);y(this,"Scheduler");let{enable_short_term:a}=this.parameters;this.Scheduler=a?H:W}params_handler_proxy(){let t=this;return{set:function(a,s,r){return s==="request_retention"&&Number.isFinite(r)?t.intervalModifier=t.calculate_interval_modifier(Number(r)):s==="enable_short_term"&&(t.Scheduler=r===!0?H:W),Reflect.set(a,s,r),!0}}}useStrategy(t,a){return this.strategyHandler.set(t,a),this}clearStrategy(t){return t?this.strategyHandler.delete(t):this.strategyHandler.clear(),this}getScheduler(t,a){let s=this.strategyHandler.get(ne.SEED),r=this.strategyHandler.get(ne.SCHEDULER)||this.Scheduler,n=s||ye;return new r(t,a,this,{seed:n})}repeat(t,a,s){let r=this.getScheduler(t,a).preview();return s&&typeof s=="function"?s(r):r}next(t,a,s,r){let n=this.getScheduler(t,a),o=d.rating(s);if(o===u.Manual)throw new Error("Cannot review a manual rating");let l=n.review(o);return r&&typeof r=="function"?r(l):l}get_retrievability(t,a,s=!0){let r=d.card(t);a=a?d.time(a):new Date;let n=r.state!==c.New?Math.max(a.diff(r.last_review,"days"),0):0,o=r.state!==c.New?this.forgetting_curve(n,+r.stability.toFixed(8)):0;return s?`${(o*100).toFixed(2)}%`:o}rollback(t,a,s){let r=d.card(t),n=d.review_log(a);if(n.rating===u.Manual)throw new Error("Cannot rollback a manual rating");let o,l,h;switch(n.state){case c.New:o=n.due,l=void 0,h=0;break;case c.Learning:case c.Relearning:case c.Review:o=n.review,l=n.due,h=r.lapses-(n.rating===u.Again&&n.state===c.Review?1:0);break}let g={...r,due:o,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.last_elapsed_days,scheduled_days:n.scheduled_days,reps:Math.max(0,r.reps-1),lapses:Math.max(0,h),state:n.state,last_review:l};return s&&typeof s=="function"?s(g):g}forget(t,a,s=!1,r){let n=d.card(t);a=d.time(a);let o=n.state===c.New?0:a.diff(n.last_review,"days"),l={rating:u.Manual,state:n.state,due:n.due,stability:n.stability,difficulty:n.difficulty,elapsed_days:0,last_elapsed_days:n.elapsed_days,scheduled_days:o,review:a},h={card:{...n,due:a,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:s?0:n.reps,lapses:s?0:n.lapses,state:c.New,last_review:n.last_review},log:l};return r&&typeof r=="function"?r(h):h}reschedule(t,a=[],s={}){let{recordLogHandler:r,reviewsOrderBy:n,skipManual:o=!0,now:l=new Date,update_memory_state:h=!1}=s;n&&typeof n=="function"&&a.sort(n),o&&(a=a.filter(De=>De.rating!==u.Manual));let g=new oe(this),w=g.reschedule(s.first_card||F(),a),f=w.length,X=d.card(t),S=g.calculateManualRecord(X,l,f?w[f-1]:void 0,h);return r&&typeof r=="function"?{collections:w.map(r),reschedule_item:S?r(S):null}:{collections:w,reschedule_item:S}}};var O=class extends p{constructor(){super(...arguments);this.buttonsWhenUnstarted=["Start learning","Not today"];this.buttonsWhenDue=["Wrong","Hard","Correct","Easy"];this.buttonsWhenNotDue=["Register repetition","Show next"]}score(t){switch(t){case"Wrong":case"Hard":case"Correct":case"Easy":this.adaptAccordingToFSRS(t);break;case"Register repetition":this.qData.due=this.isDue()?D():this.qData.due,this.qData.reps=this.qData.reps?this.qData.reps+1:1,this.qData.seen=new Date;break;case"Show next":break;case"Start learning":this.setQDataAtStartOfFSRS();break;case"Not today":this.qData.due=m();break;default:console.error("Note type doesn't know this button",t)}}getButtons(){return this.qData.stage===1?this.isDue()?this.buttonsWhenDue:this.buttonsWhenNotDue:this.qData.stage===0?this.buttonsWhenUnstarted:(console.error("getButtons(): invalid note state"),[])}setQDataAtStartOfFSRS(){this.qData.stage=1;let t=F();this.qData.due=t.due,this.qData.stability=t.stability,this.qData.difficulty=t.difficulty,this.qData.elapsed=t.elapsed_days,this.qData.scheduled=t.scheduled_days,this.qData.reps=t.reps,this.qData.lapses=t.lapses,this.qData.state=t.state,this.qData.seen=new Date}adaptAccordingToFSRS(t){this.hasAllPropsSetNeededForFSRS()||(console.warn("cannot interpret learning data, treating as new learn note"),this.setQDataAtStartOfFSRS());let a=c.New;switch(this.qData.state){case 0:a=c.New;break;case 1:a=c.Learning;break;case 2:a=c.Review;break;case 3:a=c.Relearning;break}let s={due:this.qData.due,stability:this.qData.stability,difficulty:this.qData.difficulty,elapsed_days:this.qData.elapsed,scheduled_days:this.qData.scheduled,reps:this.qData.reps,lapses:this.qData.lapses,state:a,last_review:this.qData.seen},r=A({maximum_interval:1e3}),o=new P(r).repeat(s,new Date),l;switch(t){case"Wrong":l=o[u.Again];break;case"Hard":l=o[u.Hard];break;case"Correct":l=o[u.Good];break;case"Easy":default:l=o[u.Easy];break}this.qData.due=l.card.due,this.qData.stability=l.card.stability,this.qData.difficulty=l.card.difficulty,this.qData.elapsed=l.card.elapsed_days,this.qData.scheduled=l.card.scheduled_days,this.qData.reps=l.card.reps,this.qData.lapses=l.card.lapses,this.qData.state=l.card.state,this.qData.seen=l.card.last_review,this.qData.stage=1}hasAllPropsSetNeededForFSRS(){return this.qData.due!==void 0&&this.qData.stability!==void 0&&this.qData.difficulty!==void 0&&this.qData.elapsed!==void 0&&this.qData.scheduled!==void 0&&this.qData.reps!==void 0&&this.qData.lapses!==void 0&&this.qData.state!==void 0}};var I=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["Not today","Later","Made progress","Finished"];this.buttonsWhenNotDue=["Mark progress","Finished","Show next"];this.buttonsWhenFinished=["Show next"]}score(t){switch(t){case"Not today":this.qData.due=m();break;case"Later":this.qData.due=D();break;case"Done":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Made progress":case"Mark progress":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Show next":break;default:console.error("Note type doesn't know this button",t)}}getButtons(){switch(this.qData.stage){case 0:case 1:return this.isDue()?this.buttonsWhenDue:this.buttonsWhenNotDue;case 2:return this.buttonsWhenFinished;default:return console.error("getButtons(): invalid note state"),["Show next"]}}};var $=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["No","Kind of","Yes"];this.buttonsWhenNotDue=["No","Kind of","Yes"]}score(t){this.qData.due=k(this.qData.interval||1)}};var G=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["Not today","Later","Done","Finished"];this.buttonsWhenNotDue=["Done","Finished","Show next"];this.buttonsWhenFinished=["Show next"]}score(t){switch(t){case"Not today":this.qData.due=m();break;case"Later":this.qData.due=D();break;case"Done":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Done":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Show next":break;default:console.error("Note type doesn't know this button",t)}}getButtons(){switch(this.qData.stage){case 0:case 1:return this.isDue()?this.buttonsWhenDue:this.buttonsWhenNotDue;case 2:return this.buttonsWhenFinished;default:return console.error("getButtons(): invalid note state"),["Show next"]}}};var U=class extends p{constructor(){super(...arguments);this.buttonsWhenUnstarted=["Started","Not today"];this.buttonsWhenDue=["Not today","Later","Done","Finished"];this.buttonsWhenNotDue=["Done","Finished","Show next"];this.buttonsWhenFinished=["Show next"]}score(t){switch(t){case"Not today":this.qData.due=m();break;case"Later":this.qData.due=D();break;case"Done":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Done":this.qData.due=m();break;case"Finished":this.qData.stage=2,this.qData.due=m();break;case"Started":this.qData.due=m(),this.qData.stage=1;break;case"Show next":break;default:console.error("Note type doesn't know this button",t)}}getButtons(){switch(this.qData.stage){case 0:return this.buttonsWhenUnstarted;case 1:return this.isDue()?this.buttonsWhenDue:this.buttonsWhenNotDue;case 2:return this.buttonsWhenFinished;default:return console.error("getButtons(): invalid note state"),["Show next"]}}};var z=class extends p{constructor(){super(...arguments);this.buttonsWhenDue=["Show next"];this.buttonsWhenNotDue=["Show next"]}score(t){}isDue(t,a){return!1}};var x=class{static async createNoteFromFile(e){let t=await le(e),a;return t.q?a=fe(t):a=me(t),this.create(e,a)}static create(e,t){switch(t.template){case 2:return new B(e,t);case 0:return new O(e,t);case 1:return new I(e,t);case 3:return new $(e,t);case 4:return new G(e,t);case 5:return new U(e,t);case 7:return new z(e,t);case 6:return new R(e,t)}}};var be=require("obsidian");var V=class{static logDueStats(e){let t=e.filter(f=>f.isDue()&&f.qData.template===4).length,a=e.filter(f=>f.isDue()&&f.qData.template===5&&f.qData.stage===1).length,s=e.filter(f=>f.isDue()&&f.qData.template===3).length,r=e.filter(f=>f.isDue()&&f.qData.template===2).length,n=e.filter(f=>f.isDue()&&f.qData.template===1).length,o=e.filter(f=>f.isDue()&&f.qData.template===6).length,l=e.filter(f=>f.isDue()&&f.qData.template===0&&f.qData.stage===1).length,h=e.filter(f=>f.qData.template===0&&f.qData.stage===0).length,g=e.filter(f=>f.qData.template===5&&f.qData.stage===1).length,w={createdAt:new Date,logData:{"Nr. of due articles":t,"Nr. of due started books":a,"Nr. of due checks":s,"Nr. of due habits":r,"Nr. of due todos":n,"Nr. of new learns":h,"Nr. of FSRS due notes":l,"Nr. of due misc":o,"Nr. of started books even if not due":g},logType:"due-statistics"};console.log(w)}};var Y=class{constructor(e){this.notes=[];this.notesCurrentlyLoading=!1;this.noteToExcludeBecauseWeJustHadIt=null;this.mediator=e,e.noteShuffler=this,this.streakManager=new L;let t=v();t.plugin.registerEvent(t.app.vault.on("modify",async a=>{if(this.notes.length>0&&a instanceof be.TFile&&a.extension==="md"){let s=await x.createNoteFromFile(a),r=this.notes.findIndex(n=>s.file===n.file);r!==-1&&(this.notes[r]=s)}}))}async getDueNote(){let e;return this.notes.length>0?e=this.getDueNoteFromAllNotes():e=await this.getDueNoteQuickly(),e&&this.streakManager.onNoteWasPicked(e.qData),this.noteToExcludeBecauseWeJustHadIt=e,e}requestLoadingNotes(){this.notesCurrentlyLoading||(this.notesCurrentlyLoading=!0,this.loadNotes())}async loadNotes(){let e=ee();try{let t=[];for(let a of e){let s=await x.createNoteFromFile(a);s&&s.qData.template!==7&&t.push(s)}this.notes=t,V.logDueStats(this.notes)}catch(t){console.error("Error loading notes:",t)}this.notesCurrentlyLoading=!1}getDueNoteFromAllNotes(){let e=this.getRandomTemplateToPick(),a=this.decideWhichNotesToPickFrom().filter(n=>n.isDue()&&n!==this.noteToExcludeBecauseWeJustHadIt),s=this.filterForNotesWithTemplate(a,e),r=E(s);return r||(r=E(a)),r}filterForNotesWithTemplate(e,t){return t===6?e.filter(s=>s.qData.template===6||s.qData.template===5&&s.qData.stage===2||s.qData.template===4&&s.qData.stage===2):t===4?e.filter(a=>a.qData.template===4&&a.qData.stage!==2):t===5?e.filter(a=>a.qData.template===5&&a.qData.stage!==2):e.filter(s=>s.qData.template===t)}getRandomTemplateToPick(){let e=[0,1,2,2,3,4,5,6],t=this.streakManager.getCurrentStreakTemplate();return t==null?E(e):t}decideWhichNotesToPickFrom(){return this.getFilteredNotes(this.notes)}getFilteredNotes(e){let s=e.filter(o=>o.qData.template===0&&o.qData.stage===1).filter(o=>o.isDue()).length>20,n=e.filter(o=>o.qData.template===5&&o.qData.stage===1).length>5;return s&&(e=e.filter(o=>!(o.qData.template===0&&o.qData.stage===0))),n&&(e=e.filter(o=>!(o.qData.template===5&&o.qData.stage===0))),e}async getDueNoteQuickly(){let e=null,t=ee(),a=he(0,t.length-1),s=t.slice(a).concat(t);for(let r of s){let n=await x.createNoteFromFile(r);if(n){e=n;break}}return e}};var j=class{constructor(e){this.mediator=e,e.activeNoteManager=this;let t=v();this.processNewFile(t.app.workspace.getActiveFile()),t.plugin.registerEvent(t.app.workspace.on("file-open",async a=>{this.processNewFile(a)}))}async processNewFile(e){this.activeFile=e,e?this.activeNote=await x.createNoteFromFile(e):this.activeNote=null,this.notifyNewActiveNote(this.activeNote)}notifyNewActiveNote(e){this.mediator?this.mediator.onNewActiveNote(this.activeNote):console.warn("no mediator set")}scoreAndSaveActive(e){this.activeNote&&(this.activeNote.score(e),this.activeNote.addScoreToHistory(e),ce(this.activeNote))}};var K=class{onNewActiveNote(e){this.rerenderQueueBar()}async requestNewNote(){let e=await this.noteShuffler.getDueNote();e&&de(e.file)}onBarButtonClicked(e){this.activeNoteManager.scoreAndSaveActive(e),this.requestNewNote()}rerenderQueueBar(){this.queueBar?this.activeNoteManager.activeNote?this.queueBar.renderButtonsForNote(this.activeNoteManager.activeNote.getButtons()):this.queueBar.renderButtonsForEmpty():console.warn("queue bar not yet loaded")}onQueueBarOpened(){this.noteShuffler.requestLoadingNotes(),this.rerenderQueueBar()}onQueueBarClosed(){}};var J=class extends we.Plugin{async onload(){ue(this);let t=new K;this.queueBar=new T(this.app.workspace.containerEl,t),new Y(t),new j(t),this.addRibbonIcon("square-square","Toggle Queue",a=>{this.queueBar.toggle()})}unload(){this.queueBar&&this.queueBar.el.remove()}};

/* nosourcemap */